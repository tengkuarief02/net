<script>
const base = location.origin;

/**
 * AMBIL ARRAY DENGAN AMAN
 */
function getList(j){
  if (!j) return [];
  if (Array.isArray(j)) return j;
  if (Array.isArray(j.data)) return j.data;
  if (j.data && Array.isArray(j.data.list)) return j.data.list;
  if (Array.isArray(j.result)) return j.result;
  if (j.result && Array.isArray(j.result.list)) return j.result.list;
  return [];
}

/**
 * AMBIL GAMBAR DENGAN AMAN
 */
function getImage(d){
  if (!d) return 'https://via.placeholder.com/300x450?text=No+Image';
  let img =
    d.cover ||
    d.coverImage ||
    d.poster ||
    d.image ||
    d.thumbnail ||
    '';

  if (!img) return 'https://via.placeholder.com/300x450?text=No+Image';
  if (img.startsWith('http://')) img = img.replace('http://', 'https://');
  return img;
}

function render(el, list){
  el.innerHTML = '';
  if (!Array.isArray(list) || list.length === 0){
    el.innerHTML = '<div>Tidak ada data</div>';
    return;
  }

  list.forEach(d=>{
    if (!d.shortPlayId) return;
    el.innerHTML += `
      <a class="card" href="episodes.html?id=${d.shortPlayId}">
        <img src="${getImage(d)}">
        <div>${d.title || 'Untitled'}</div>
      </a>
    `;
  });
}

// THEATERS
fetch(base + '/api/theaters')
.then(r=>r.json())
.then(j=>{
  const list = getList(j);
  console.log('THEATERS LIST:', list);
  render(document.getElementById('theaters'), list);
})
.catch(e=>console.error(e));

// FOR YOU
fetch(base + '/api/foryou')
.then(r=>r.json())
.then(j=>{
  const list = getList(j);
  console.log('FORYOU LIST:', list);
  render(document.getElementById('foryou'), list);
})
.catch(e=>console.error(e));
</script>
