<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>NetShort</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#000;color:#fff;font-family:sans-serif}
h2{margin:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;padding:12px}
.card img{width:100%;height:210px;object-fit:cover;border-radius:6px;background:#111}
a{color:#fff;text-decoration:none}
</style>
</head>
<body>

<h2>Theaters</h2>
<div id="theaters" class="grid"></div>

<h2>For You</h2>
<div id="foryou" class="grid"></div>

<script>
function extractList(j){
  if (!j) return [];
  if (Array.isArray(j)) return j;
  if (j.data && Array.isArray(j.data.list)) return j.data.list;
  if (Array.isArray(j.data)) return j.data;
  if (j.result && Array.isArray(j.result.list)) return j.result.list;
  if (Array.isArray(j.result)) return j.result;
  return [];
}

function getImg(d){
  let img = d.cover || d.poster || d.image || d.thumbnail || '';
  if (!img) return 'https://via.placeholder.com/300x450?text=No+Image';
  if (img.startsWith('http://')) img = img.replace('http://','https://');
  return img;
}

function render(el, list){
  el.innerHTML = '';
  list.forEach(d=>{
    if (!d.shortPlayId) return;
    el.innerHTML += `
      <a class="card" href="episodes.html?id=${d.shortPlayId}">
        <img src="${getImg(d)}">
        <div>${d.title || 'Untitled'}</div>
      </a>
    `;
  });
}

fetch('/api/theaters')
.then(r=>r.json())
.then(j=>render(theaters, extractList(j)));

fetch('/api/foryou')
.then(r=>r.json())
.then(j=>render(foryou, extractList(j)));
</script>

</body>
</html>
